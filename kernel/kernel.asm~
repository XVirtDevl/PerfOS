%define FLAGS 3
%define MAGIC 0x1BADB002
%define CHECKSUM -(MAGIC+FLAGS)

section multiboot
align 4
my_magic dd MAGIC
dd FLAGS
dd CHECKSUM
align 8
%define GDT_BASE 0x1000
gdt_limit dw 24
gdt_base dd GDT_BASE

extern main
section .text
global _start
_start:
	xor eax, eax
	mov dword[ GDT_BASE+0 ], eax
	mov dword[ GDT_BASE+4 ], eax
	mov eax, 0xFFFF0000
	mov dword[ GDT_BASE+8 ], eax
	mov dword[ GDT_BASE+16 ], eax

	mov eax, 0x009ACF00
	mov dword[ GDT_BASE+12 ], eax
	and eax, 0xFFF7FFFF
	mov dword[ GDT_BASE+20 ], eax
	lgdt[ gdt_limit ]
	jmp 0x8:_OwnGDT	

align 8
	_OwnGDT:
		mov ax, 0x10
		mov ds, ax
		mov es, ax
		mov fs, ax
		mov gs, ax
		mov ss, ax
	
		push ebx
		call main
		jmp $
